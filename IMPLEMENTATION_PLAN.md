# üöÄ RecastNavigation Zig - –ü–æ–ª–Ω—ã–π –ü–ª–∞–Ω –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:**
- **21,704** —Å—Ç—Ä–æ–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞ (C++)
- **6** –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- **50+** —Ñ–∞–π–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- **7** —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–ü—Ä–∏–º–µ—Ä—ã:** RecastDemo —Å GUI

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:**
- ‚úÖ **1,709** —Å—Ç—Ä–æ–∫ Zig (7.5%)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏
- ‚ùå –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
- ‚ùå –ê–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚ùå –¢–µ—Å—Ç—ã
- ‚ùå –ü—Ä–∏–º–µ—Ä—ã

---

# üéØ –§–ê–ó–ê 0: –§—É–Ω–¥–∞–º–µ–Ω—Ç (–ó–ê–í–ï–†–®–ï–ù–ê) ‚úÖ

## 0.1 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
- [x] `build.zig` - —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏
- [x] `src/root.zig` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- [x] `README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] `LICENSE` - –ª–∏—Ü–µ–Ω–∑–∏—è
- [x] `.gitignore` - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

## 0.2 –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ‚úÖ
**–§–∞–π–ª:** `src/math.zig`
- [x] `Vec3` - 3D –≤–µ–∫—Ç–æ—Ä—ã
- [x] `Vec2` - 2D –≤–µ–∫—Ç–æ—Ä—ã
- [x] `AABB` - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–µ –æ–±—ä—ë–º—ã
- [x] –£—Ç–∏–ª–∏—Ç—ã: min, max, abs, sqr, clamp
- [x] –ì–µ–æ–º–µ—Ç—Ä–∏—è: triArea2D, closestPtPointTriangle, pointInPolygon
- [x] –ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: nextPow2, ilog2, align4

## 0.3 –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚úÖ
**Recast:**
- [x] `Config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [x] `Heightfield` - –≤—ã—Å–æ—Ç–Ω–æ–µ –ø–æ–ª–µ
- [x] `CompactHeightfield` - –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- [x] `Span`, `SpanPool`, `CompactSpan`, `CompactCell`
- [x] `PolyMesh`, `PolyMeshDetail`
- [x] `Contour`, `ContourSet`
- [x] `HeightfieldLayer`, `HeightfieldLayerSet`

**Detour:**
- [x] `NavMesh`, `NavMeshParams`
- [x] `Poly`, `PolyDetail`
- [x] `Link`, `BVNode`
- [x] `OffMeshConnection`
- [x] `MeshTile`, `MeshHeader`
- [x] `Status`, `PolyRef`, `TileRef`

---

# üì¶ –§–ê–ó–ê 1: –ú–æ–¥—É–ª—å Recast - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ NavMesh

## 1.1 Rasterization (–†–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastRasterization.cpp` (629 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/recast/rasterization.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
pub fn rasterizeTriangle(
    ctx: *Context,
    v0: Vec3, v1: Vec3, v2: Vec3,
    area: u8,
    heightfield: *Heightfield,
    flag_merge_threshold: i32
) !bool

pub fn rasterizeTriangles(
    ctx: *Context,
    verts: []const f32,
    nv: i32,
    tris: []const i32,
    area_ids: []const u8,
    nt: i32,
    heightfield: *Heightfield,
    flag_merge_threshold: i32
) !bool

pub fn rasterizeTriangles_u16(
    ctx: *Context,
    verts: []const f32,
    nv: i32,
    tris: []const u16,
    area_ids: []const u8,
    nt: i32,
    heightfield: *Heightfield,
    flag_merge_threshold: i32
) !bool

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn addSpan(
    heightfield: *Heightfield,
    x: i32, z: i32,
    smin: u16, smax: u16,
    area: u8,
    flag_merge_threshold: i32
) !void

fn dividePoly(
    buf: []Vec3,
    in: []Vec3,
    axis: i32,
    axis_dir: f32,
    out1: []Vec3,
    out2: []Vec3
) void
```

**–¢–µ—Å—Ç—ã:**
- –†–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
- –†–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–µ—à–∞
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (–≤—ã—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –º–µ—à–∞—Ö

---

## 1.2 Filtering (–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastFilter.cpp` (321 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/recast/filter.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∏–∑–∫–æ –≤–∏—Å—è—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
pub fn filterLowHangingWalkableObstacles(
    ctx: *Context,
    walkable_climb: i32,
    heightfield: *Heightfield
) void

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã—Å—Ç—É–ø–æ–≤
pub fn filterLedgeSpans(
    ctx: *Context,
    walkable_height: i32,
    walkable_climb: i32,
    heightfield: *Heightfield
) void

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∏–∑–∫–∏—Ö –ø—Ä–æ–ª—ë—Ç–æ–≤
pub fn filterWalkableLowHeightSpans(
    ctx: *Context,
    walkable_height: i32,
    heightfield: *Heightfield
) void

// –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
pub fn markWalkableTriangles(
    ctx: *Context,
    walkable_slope_angle: f32,
    verts: []const f32,
    nv: i32,
    tris: []const i32,
    nt: i32,
    area_ids: []u8
) void

// –û—á–∏—Å—Ç–∫–∞ –Ω–µ–ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
pub fn clearUnwalkableTriangles(
    ctx: *Context,
    walkable_slope_angle: f32,
    verts: []const f32,
    nv: i32,
    tris: []const i32,
    nt: i32,
    area_ids: []u8
) void
```

**–¢–µ—Å—Ç—ã:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
- –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

## 1.3 Compact Heightfield (–ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/Recast.cpp` (—Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è CHF)
**–¶–µ–ª—å:** `src/recast/compact.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ heightfield
pub fn buildCompactHeightfield(
    ctx: *Context,
    walkable_height: i32,
    walkable_climb: i32,
    heightfield: *const Heightfield,
    chf: *CompactHeightfield
) !bool

// –ü–æ–¥—Å—á—ë—Ç spans
pub fn getHeightFieldSpanCount(
    ctx: *Context,
    heightfield: *const Heightfield
) i32

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É spans
fn setConnection(
    span: *CompactSpan,
    direction: u2,
    neighbor_idx: u8
) void

fn getConnection(
    span: *const CompactSpan,
    direction: u2
) u8
```

**–¢–µ—Å—Ç—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ—Å—Ç–æ–≥–æ heightfield
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

---

## 1.4 Area Modification (–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±–ª–∞—Å—Ç–µ–π)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastArea.cpp` (541 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/recast/area.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –≠—Ä–æ–∑–∏—è –ø—Ä–æ—Ö–æ–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
pub fn erodeWalkableArea(
    ctx: *Context,
    erosion_radius: i32,
    chf: *CompactHeightfield
) !bool

// –ú–µ–¥–∏–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
pub fn medianFilterWalkableArea(
    ctx: *Context,
    chf: *CompactHeightfield
) !bool

// –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
pub fn markBoxArea(
    ctx: *Context,
    bmin: Vec3,
    bmax: Vec3,
    area_id: u8,
    chf: *CompactHeightfield
) void

// –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–ø—É–∫–ª–æ–≥–æ –ø–æ–ª–∏–≥–æ–Ω–∞
pub fn markConvexPolyArea(
    ctx: *Context,
    verts: []const f32,
    nverts: i32,
    hmin: f32,
    hmax: f32,
    area_id: u8,
    chf: *CompactHeightfield
) void

// –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ü–∏–ª–∏–Ω–¥—Ä–∞
pub fn markCylinderArea(
    ctx: *Context,
    pos: Vec3,
    r: f32,
    h: f32,
    area_id: u8,
    chf: *CompactHeightfield
) void

// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞
pub fn offsetPoly(
    verts: []const f32,
    nverts: i32,
    offset: f32,
    out_verts: []f32,
    max_out_verts: i32
) i32
```

**–¢–µ—Å—Ç—ã:**
- –≠—Ä–æ–∑–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–¥–∏—É—Å–æ–≤
- –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º
- –ú–µ–¥–∏–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä

---

## 1.5 Region Building (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastRegion.cpp` (1,893 —Å—Ç—Ä–æ–∫–∏!)
**–¶–µ–ª—å:** `src/recast/region.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ distance field
pub fn buildDistanceField(
    ctx: *Context,
    chf: *CompactHeightfield
) !bool

// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤ (watershed)
pub fn buildRegions(
    ctx: *Context,
    chf: *CompactHeightfield,
    border_size: i32,
    min_region_area: i32,
    merge_region_area: i32
) !bool

// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤ (monotone)
pub fn buildRegionsMonotone(
    ctx: *Context,
    chf: *CompactHeightfield,
    border_size: i32,
    min_region_area: i32,
    merge_region_area: i32
) !bool

// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ—ë–≤ (layers)
pub fn buildLayerRegions(
    ctx: *Context,
    chf: *CompactHeightfield,
    border_size: i32,
    min_region_area: i32
) !bool

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
const Region = struct {
    span_count: i32,
    id: u16,
    area_type: u8,
    remap: bool,
    visited: bool,
    overlap: bool,
    connections: std.ArrayList(u16),
    floors: std.ArrayList(i32),
};
```

**–¢–µ—Å—Ç—ã:**
- Watershed –∞–ª–≥–æ—Ä–∏—Ç–º
- Monotone —Ä–∞–∑–±–∏–µ–Ω–∏–µ
- –°–ª–∏—è–Ω–∏–µ –º–∞–ª—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## 1.6 Contour Building (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastContour.cpp` (1,077 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/recast/contour.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤
pub fn buildContours(
    ctx: *Context,
    chf: *const CompactHeightfield,
    max_error: f32,
    max_edge_len: i32,
    cset: *ContourSet,
    build_flags: i32
) !bool

// –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ (Douglas-Peucker)
fn simplifyContour(
    points: []i32,
    simplified: []i32,
    max_error: f32,
    max_edge_len: i32,
    build_flags: i32
) i32

// –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
fn removeDegenerateSegments(
    simplified: []i32
) void

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn walkContour(
    x: i32, y: i32, i: i32,
    chf: *const CompactHeightfield,
    flags: []u8,
    points: []i32
) i32

fn distancePtSeg(
    x: i32, z: i32,
    px: i32, pz: i32,
    qx: i32, qz: i32
) f32
```

**–¢–µ—Å—Ç—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ –∏–∑ —Ä–µ–≥–∏–æ–Ω–æ–≤
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

---

## 1.7 Polygon Mesh Building (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastMesh.cpp` (1,477 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/recast/mesh.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏
pub fn buildPolyMesh(
    ctx: *Context,
    cset: *const ContourSet,
    nvp: i32,
    mesh: *PolyMesh
) !bool

// –°–ª–∏—è–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–æ–∫
pub fn mergePolyMeshes(
    ctx: *Context,
    meshes: []*PolyMesh,
    nmeshes: i32,
    mesh: *PolyMesh
) !bool

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏
pub fn copyPolyMesh(
    ctx: *Context,
    src: *const PolyMesh,
    dst: *PolyMesh
) !bool

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn triangulate(
    n: i32,
    verts: []const i32,
    indices: []i32,
    tris: []u16
) i32

fn buildMeshAdjacency(
    polys: []u16,
    npolys: i32,
    nverts: i32,
    vertsPerPoly: i32
) void

fn getPolyMergeValue(
    polys: []u16,
    pa: i32, pb: i32,
    verts: []u16,
    ea: *i32, eb: *i32,
    nvp: i32
) i32

fn mergePolys(
    polys: []u16,
    pa: i32, pb: i32,
    ea: i32, eb: i32,
    nvp: i32
) void
```

**–¢–µ—Å—Ç—ã:**
- –¢—Ä–∏–∞–Ω–≥—É–ª—è—Ü–∏—è –∫–æ–Ω—Ç—É—Ä–æ–≤
- –°–ª–∏—è–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–æ–≤
- –°–ª–∏—è–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—à–µ–π
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Ä—ë–±—Ä–∞

---

## 1.8 Detail Mesh Building (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastMeshDetail.cpp` (1,143 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/recast/detail.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏
pub fn buildPolyMeshDetail(
    ctx: *Context,
    mesh: *const PolyMesh,
    chf: *const CompactHeightfield,
    sample_dist: f32,
    sample_max_error: f32,
    dmesh: *PolyMeshDetail
) !bool

// –°–ª–∏—è–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–æ–∫
pub fn mergePolyMeshDetails(
    ctx: *Context,
    meshes: []*PolyMeshDetail,
    nmeshes: i32,
    dmesh: *PolyMeshDetail
) !bool

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
const HeightPatch = struct {
    data: []u16,
    xmin: i32, ymin: i32,
    width: i32, height: i32,
};

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn getHeightData(
    chf: *const CompactHeightfield,
    poly: []const u16,
    npoly: i32,
    verts: []const u16,
    border_size: i32,
    hp: *HeightPatch,
    region: i32
) bool

fn buildPolyDetail(
    ctx: *Context,
    in_: []const f32,
    nin: i32,
    sample_dist: f32,
    sample_max_error: f32,
    chf: *const CompactHeightfield,
    hp: *const HeightPatch,
    verts: []f32,
    nverts: *i32,
    tris: []u8,
    ntris: *i32,
    edges: []i32,
    samples: []i32
) void

fn seedArrayWithPolyCenter(
    chf: *const CompactHeightfield,
    poly: []const u16,
    npoly: i32,
    verts: []const u16,
    bs: i32,
    hp: *const HeightPatch,
    array: []i32
) void

fn delaunayHull(
    ctx: *Context,
    npts: i32,
    pts: []const f32,
    nhull: i32,
    hull: []const i32,
    tris: []u8,
    edges: []i32
) i32

fn getJitterX(i: i32) i32
fn getJitterY(i: i32) i32
```

**–¢–µ—Å—Ç—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏
- –°–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Å–æ—Ç
- Delaunay —Ç—Ä–∏–∞–Ω–≥—É–ª—è—Ü–∏—è
- –°–ª–∏—è–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–æ–∫

---

## 1.9 Heightfield Layers (–°–ª–æ–∏ –≤—ã—Å–æ—Ç–Ω–æ–≥–æ –ø–æ–ª—è)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastLayers.cpp` (621 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/recast/layers.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ—ë–≤ heightfield
pub fn buildHeightfieldLayers(
    ctx: *Context,
    chf: *const CompactHeightfield,
    border_size: i32,
    walkable_height: i32,
    lset: *HeightfieldLayerSet
) !bool

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
const LayerId = struct {
    index: i32,
    count: i32,
    base_id: i32,
};

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn contains(
    a: []const u8,
    an: i32,
    v: u8
) bool
```

**–¢–µ—Å—Ç—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ—ë–≤
- –ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è
- –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏

---

## 1.10 Recast Utilities
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Recast/Source/RecastAlloc.cpp`, `RecastAssert.cpp`
**–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Zig –∏–¥–∏–æ–º—ã

```zig
// –ê–ª–ª–æ–∫–∞—Ç–æ—Ä—ã —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ Zig
// Assert –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å std.debug.assert
```

---

# üß≠ –§–ê–ó–ê 2: –ú–æ–¥—É–ª—å Detour - –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ Pathfinding

## 2.1 NavMesh Builder
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Detour/Source/DetourNavMeshBuilder.cpp` (531 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/detour/builder.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –°–æ–∑–¥–∞–Ω–∏–µ NavMesh –¥–∞–Ω–Ω—ã—Ö –∏–∑ PolyMesh
pub fn createNavMeshData(
    params: *const NavMeshCreateParams,
    out_data: *[]u8,
    out_data_size: *i32
) !bool

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è
pub const NavMeshCreateParams = struct {
    verts: []const u16,
    vert_count: i32,
    polys: []const u16,
    poly_areas: []const u8,
    poly_flags: []const u16,
    poly_count: i32,
    nvp: i32,
    detail_meshes: []const u32,
    detail_verts: []const f32,
    detail_verts_count: i32,
    detail_tris: []const u8,
    detail_tri_count: i32,
    off_mesh_con_verts: []const f32,
    off_mesh_con_rad: []const f32,
    off_mesh_con_flags: []const u16,
    off_mesh_con_areas: []const u8,
    off_mesh_con_dir: []const u8,
    off_mesh_con_user_id: []const u32,
    off_mesh_con_count: i32,
    user_id: u32,
    tile_x: i32,
    tile_y: i32,
    tile_layer: i32,
    bmin: Vec3,
    bmax: Vec3,
    walkable_height: f32,
    walkable_radius: f32,
    walkable_climb: f32,
    cs: f32,
    ch: f32,
    build_bv_tree: bool,
};

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn classifyOffMeshPoint(
    pt: Vec3,
    bmin: Vec3,
    bmax: Vec3
) u8

fn createBVTree(
    ctx: *Context,
    verts: []const u16,
    polys: []const u16,
    npolys: i32,
    nvp: i32,
    cs: f32,
    ch: f32,
    nnodes: i32,
    nodes: []BVNode
) bool
```

**–¢–µ—Å—Ç—ã:**
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–≤–º–µ—à–∞ –∏–∑ PolyMesh
- Off-mesh connections
- BVH –¥–µ—Ä–µ–≤–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## 2.2 NavMesh Core
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Detour/Source/DetourNavMesh.cpp` (1,852 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/detour/navmesh.zig` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–ª–∞–º–∏
pub fn addTile(
    self: *NavMesh,
    data: []u8,
    data_size: i32,
    flags: i32,
    last_ref: TileRef,
    result: *TileRef
) !Status

pub fn removeTile(
    self: *NavMesh,
    ref: TileRef,
    data: *[]u8,
    data_size: *i32
) !Status

// –ó–∞–ø—Ä–æ—Å—ã —Ç–∞–π–ª–æ–≤
pub fn getTileAt(
    self: *const NavMesh,
    x: i32, y: i32, layer: i32
) ?*const MeshTile

pub fn getTilesAt(
    self: *const NavMesh,
    x: i32, y: i32,
    tiles: []?*const MeshTile,
    max_tiles: i32
) i32

pub fn getTileByRef(
    self: *const NavMesh,
    ref: TileRef
) ?*const MeshTile

pub fn getTileAndPolyByRef(
    self: *const NavMesh,
    ref: PolyRef,
    tile: **const MeshTile,
    poly: **const Poly
) Status

// –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
pub fn setPolyFlags(
    self: *NavMesh,
    ref: PolyRef,
    flags: u16
) Status

pub fn getPolyFlags(
    self: *const NavMesh,
    ref: PolyRef,
    result_flags: *u16
) Status

pub fn setPolyArea(
    self: *NavMesh,
    ref: PolyRef,
    area: u8
) Status

pub fn getPolyArea(
    self: *const NavMesh,
    ref: PolyRef,
    result_area: *u8
) Status

// –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
pub fn storeTileState(
    self: *const NavMesh,
    tile: *const MeshTile,
    data: []u8,
    max_data_size: i32
) Status

pub fn restoreTileState(
    self: *NavMesh,
    tile: *MeshTile,
    data: []const u8,
    max_data_size: i32
) Status

// Off-mesh connections
pub fn getOffMeshConnectionPolyEndPoints(
    self: *const NavMesh,
    prev_ref: PolyRef,
    poly_ref: PolyRef,
    start_pos: *Vec3,
    end_pos: *Vec3
) Status

pub fn getOffMeshConnectionByRef(
    self: *const NavMesh,
    ref: PolyRef
) ?*const OffMeshConnection

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn connectExtLinks(
    self: *NavMesh,
    tile: *MeshTile,
    target: *MeshTile,
    side: i32
) void

fn connectExtOffMeshLinks(
    self: *NavMesh,
    tile: *MeshTile,
    target: *MeshTile,
    side: i32
) void

fn unconnectLinks(
    self: *NavMesh,
    tile: *MeshTile,
    target: *MeshTile
) void

fn connectIntLinks(
    self: *NavMesh,
    tile: *MeshTile
) void

fn baseOffMeshLinks(
    self: *NavMesh,
    tile: *MeshTile
) void
```

**–¢–µ—Å—Ç—ã:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–π–ª–æ–≤
- –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–∞–π–ª–æ–≤
- Off-mesh connections
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

---

## 2.3 NavMesh Query (–ó–∞–ø—Ä–æ—Å—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Detour/Source/DetourNavMeshQuery.cpp` (2,741 —Å—Ç—Ä–æ–∫–∞!)
**–¶–µ–ª—å:** `src/detour/query.zig`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```zig
pub const NavMeshQuery = struct {
    nav: *const NavMesh,
    tiny_node_pool: *NodePool,
    node_pool: *NodePool,
    open_list: *NodeQueue,
    query_data: QueryData,
    allocator: std.mem.Allocator,
};

pub const Filter = struct {
    area_cost: [MAX_AREAS]f32 = [_]f32{1.0} ** MAX_AREAS,
    include_flags: u16 = 0xffff,
    exclude_flags: u16 = 0,

    pub fn passFilter(
        self: *const Filter,
        ref: PolyRef,
        tile: *const MeshTile,
        poly: *const Poly
    ) bool;

    pub fn getCost(
        self: *const Filter,
        pa: Vec3, pb: Vec3,
        prev_ref: PolyRef,
        prev_tile: *const MeshTile,
        prev_poly: *const Poly,
        cur_ref: PolyRef,
        cur_tile: *const MeshTile,
        cur_poly: *const Poly,
        next_ref: PolyRef,
        next_tile: *const MeshTile,
        next_poly: *const Poly
    ) f32;
};

pub const RaycastHit = struct {
    t: f32 = 0,
    hit_normal: Vec3 = Vec3.zero(),
    hit_edge_index: i32 = 0,
    path: []PolyRef,
    path_count: i32 = 0,
    max_path: i32,
    path_cost: f32 = 0,
};
```

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
pub fn init(
    nav: *const NavMesh,
    max_nodes: i32,
    allocator: std.mem.Allocator
) !NavMeshQuery

pub fn deinit(self: *NavMeshQuery) void

// === –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã ===
pub fn findNearestPoly(
    self: *NavMeshQuery,
    center: Vec3,
    half_extents: Vec3,
    filter: *const Filter,
    nearest_ref: *PolyRef,
    nearest_pt: *Vec3
) Status

pub fn queryPolygons(
    self: *NavMeshQuery,
    center: Vec3,
    half_extents: Vec3,
    filter: *const Filter,
    polys: []PolyRef,
    poly_count: *i32,
    max_polys: i32
) Status

pub fn findLocalNeighbourhood(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    center_pos: Vec3,
    radius: f32,
    filter: *const Filter,
    result_ref: []PolyRef,
    result_parent: []PolyRef,
    result_count: *i32,
    max_result: i32
) Status

// === –ü–æ–∏—Å–∫ –ø—É—Ç–∏ (A*) ===
pub fn findPath(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    end_ref: PolyRef,
    start_pos: Vec3,
    end_pos: Vec3,
    filter: *const Filter,
    path: []PolyRef,
    path_count: *i32,
    max_path: i32
) Status

pub fn initSlicedFindPath(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    end_ref: PolyRef,
    start_pos: Vec3,
    end_pos: Vec3,
    filter: *const Filter,
    options: u32
) Status

pub fn updateSlicedFindPath(
    self: *NavMeshQuery,
    max_iter: i32,
    done_iters: *i32
) Status

pub fn finalizeSlicedFindPath(
    self: *NavMeshQuery,
    path: []PolyRef,
    path_count: *i32,
    max_path: i32
) Status

pub fn finalizeSlicedFindPathPartial(
    self: *NavMeshQuery,
    existing: []const PolyRef,
    existing_size: i32,
    path: []PolyRef,
    path_count: *i32,
    max_path: i32
) Status

// === –ü—Ä—è–º–æ–π –ø—É—Ç—å (straight path) ===
pub fn findStraightPath(
    self: *const NavMeshQuery,
    start_pos: Vec3,
    end_pos: Vec3,
    path: []const PolyRef,
    path_size: i32,
    straight_path: []Vec3,
    straight_path_flags: []u8,
    straight_path_refs: []PolyRef,
    straight_path_count: *i32,
    max_straight_path: i32,
    options: i32
) Status

// === Raycast ===
pub fn raycast(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    start_pos: Vec3,
    end_pos: Vec3,
    filter: *const Filter,
    t: *f32,
    hit_normal: *Vec3,
    path: []PolyRef,
    path_count: *i32,
    max_path: i32
) Status

pub fn raycast_v2(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    start_pos: Vec3,
    end_pos: Vec3,
    filter: *const Filter,
    options: u32,
    hit: *RaycastHit,
    prev_ref: PolyRef
) Status

// === –î–≤–∏–∂–µ–Ω–∏–µ –≤–¥–æ–ª—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ ===
pub fn moveAlongSurface(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    start_pos: Vec3,
    end_pos: Vec3,
    filter: *const Filter,
    result_pos: *Vec3,
    visited: []PolyRef,
    visited_count: *i32,
    max_visited_size: i32
) Status

// === –í—ã—Å–æ—Ç–∞ –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ===
pub fn getPolyHeight(
    self: *const NavMeshQuery,
    ref: PolyRef,
    pos: Vec3,
    height: *f32
) Status

pub fn findDistanceToWall(
    self: *NavMeshQuery,
    start_ref: PolyRef,
    center_pos: Vec3,
    max_radius: f32,
    filter: *const Filter,
    hit_dist: *f32,
    hit_pos: *Vec3,
    hit_normal: *Vec3
) Status

pub fn closestPointOnPoly(
    self: *const NavMeshQuery,
    ref: PolyRef,
    pos: Vec3,
    closest: *Vec3,
    pos_over_poly: *bool
) Status

pub fn closestPointOnPolyBoundary(
    self: *const NavMeshQuery,
    ref: PolyRef,
    pos: Vec3,
    closest: *Vec3
) Status

// === –í–∞–ª–∏–¥–∞—Ü–∏—è ===
pub fn isValidPolyRef(
    self: *const NavMeshQuery,
    ref: PolyRef,
    filter: *const Filter
) bool

pub fn isInClosedList(
    self: *const NavMeshQuery,
    ref: PolyRef
) bool

// === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
pub fn getPathFromDijkstraSearch(
    self: *NavMeshQuery,
    end_ref: PolyRef,
    path: []PolyRef,
    path_count: *i32,
    max_path: i32
) Status

pub fn getAttachedNavMesh(
    self: *const NavMeshQuery
) *const NavMesh
```

**–¢–µ—Å—Ç—ã:**
- A* pathfinding –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—à–∞—Ö
- Raycast —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
- –î–≤–∏–∂–µ–Ω–∏–µ –≤–¥–æ–ª—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
- Straight path –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- Sliced pathfinding
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

---

## 2.4 Node Pool (–ü—É–ª —É–∑–ª–æ–≤ –¥–ª—è A*)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Detour/Source/DetourNode.cpp` (292 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/detour/node.zig`

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:
```zig
pub const Node = struct {
    pos: Vec3,
    cost: f32,
    total: f32,
    pidx: u32,  // parent index
    flags: u8,
    id: PolyRef,
};

pub const NodePool = struct {
    nodes: []Node,
    first: []u16,
    next: []u16,
    max_nodes: i32,
    hash_size: i32,
    node_count: i32,
    allocator: std.mem.Allocator,

    pub fn init(max_nodes: i32, hash_size: i32, allocator: std.mem.Allocator) !NodePool;
    pub fn deinit(self: *NodePool) void;
    pub fn clear(self: *NodePool) void;
    pub fn getNode(self: *NodePool, id: PolyRef, flags: u8) ?*Node;
    pub fn findNode(self: *const NodePool, id: PolyRef) ?*const Node;
    pub fn getNodeIdx(self: *const NodePool, node: *const Node) u32;
    pub fn getNodeAtIdx(self: *const NodePool, idx: u32) ?*Node;
    pub fn getMemUsed(self: *const NodePool) i32;
};

pub const NodeQueue = struct {
    heap: []Node,
    capacity: i32,
    size: i32,
    allocator: std.mem.Allocator,

    pub fn init(n: i32, allocator: std.mem.Allocator) !NodeQueue;
    pub fn deinit(self: *NodeQueue) void;
    pub fn clear(self: *NodeQueue) void;
    pub fn top(self: *NodeQueue) ?*Node;
    pub fn pop(self: *NodeQueue) ?*Node;
    pub fn push(self: *NodeQueue, node: *Node) void;
    pub fn modify(self: *NodeQueue, node: *Node) void;
    pub fn empty(self: *const NodeQueue) bool;
};
```

**–¢–µ—Å—Ç—ã:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤
- –û—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- –•–µ—à-—Ç–∞–±–ª–∏—Ü–∞ —É–∑–ª–æ–≤

---

## 2.5 Detour Common (–û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏)
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Detour/Source/DetourCommon.cpp` (571 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/detour/common_funcs.zig`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
pub fn intersectSegmentPoly2D(
    p0: Vec3, p1: Vec3,
    verts: []const Vec3,
    nverts: i32,
    tmin: *f32, tmax: *f32,
    seg_min: *i32, seg_max: *i32
) bool

pub fn intersectSegSeg2D(
    ap: Vec3, aq: Vec3,
    bp: Vec3, bq: Vec3,
    s: *f32, t: *f32
) bool

// –†–∞—Å—Å—Ç–æ—è–Ω–∏—è
pub fn distancePtSegSqr2D(
    pt: Vec3,
    p: Vec3, q: Vec3,
    t: *f32
) f32

pub fn distancePtPolyEdgesSqr(
    pt: Vec3,
    verts: []const Vec3,
    nverts: i32,
    ed: []f32,
    et: []f32
) f32

// –¢–æ—á–∫–∞ –≤ –ø–æ–ª–∏–≥–æ–Ω–µ
pub fn pointInPolygon(
    pt: Vec3,
    verts: []const Vec3,
    nverts: i32
) bool

// –ë–ª–∏–∂–∞–π—à–∞—è —Ç–æ—á–∫–∞ –Ω–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–µ
pub fn closestPtPointTriangle(
    closest: *Vec3,
    p: Vec3,
    a: Vec3, b: Vec3, c: Vec3
) void

pub fn closestHeightPointTriangle(
    p: Vec3,
    a: Vec3, b: Vec3, c: Vec3,
    h: *f32
) bool

// –°–ª—É—á–∞–π–Ω–∞—è —Ç–æ—á–∫–∞ –≤ –ø–æ–ª–∏–≥–æ–Ω–µ
pub fn randomPointInConvexPoly(
    pts: []const Vec3,
    npts: i32,
    areas: []f32,
    s: f32, t: f32,
    out: *Vec3
) void

// –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–∏–≥–æ–Ω–æ–≤
pub fn overlapPolyPoly2D(
    polya: []const Vec3, npolya: i32,
    polyb: []const Vec3, npolyb: i32
) bool

// –¶–µ–Ω—Ç—Ä –ø–æ–ª–∏–≥–æ–Ω–∞
pub fn calcPolyCenter(
    tc: *Vec3,
    idx: []const u16,
    nidx: i32,
    verts: []const Vec3
) void
```

**–¢–µ—Å—Ç—ã:**
- –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –¢–æ—á–∫–∞ –≤ –ø–æ–ª–∏–≥–æ–Ω–µ
- –†–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Ä—ë–±–µ—Ä
- –°–ª—É—á–∞–π–Ω—ã–µ —Ç–æ—á–∫–∏

---

# üë• –§–ê–ó–ê 3: –ú–æ–¥—É–ª—å DetourCrowd - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª–ø–æ–π

## 3.1 Crowd Manager
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourCrowd.cpp` (1,558 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/detour_crowd/crowd.zig`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```zig
pub const CrowdAgent = struct {
    active: bool,
    state: CrowdAgentState,
    corridor: PathCorridor,
    boundary: LocalBoundary,
    topography_opt_time: f32,
    neis: [DT_CROWDAGENT_MAX_NEIGHBOURS]CrowdNeighbour,
    nneis: i32,
    desired_speed: f32,
    npos: Vec3,
    disp: Vec3,
    dvel: Vec3,
    nvel: Vec3,
    vel: Vec3,
    params: CrowdAgentParams,
    corners: [DT_CROWDAGENT_MAX_CORNERS]Vec3,
    ncorners: i32,
    target_state: MoveRequestState,
    target_ref: PolyRef,
    target_pos: Vec3,
    target_path_q_ref: PathQueueRef,
    target_replan: bool,
    target_replan_time: f32,
};

pub const CrowdAgentParams = struct {
    radius: f32,
    height: f32,
    max_acceleration: f32,
    max_speed: f32,
    collision_query_range: f32,
    path_optimization_range: f32,
    separation_weight: f32,
    update_flags: u8,
    obstacle_avoidance_type: u8,
    query_filter_type: u8,
    user_data: ?*anyopaque,
};

pub const Crowd = struct {
    max_agents: i32,
    agents: []CrowdAgent,
    active_agents: []CrowdAgent,
    agent_anims: []CrowdAgentAnimation,
    path_q: PathQueue,
    avoidance_params: [DT_CROWD_MAX_OBSTAVOIDANCE_PARAMS]ObstacleAvoidanceParams,
    avoidance_query: ObstacleAvoidanceQuery,
    grid: ProximityGrid,
    path_result: []PolyRef,
    max_path_result: i32,
    ext: Vec3,
    filters: [DT_CROWD_MAX_QUERY_FILTER_TYPE]QueryFilter,
    max_agent_radius: f32,
    velocity_sample_count: i32,
    nav_query: NavMeshQuery,
    allocator: std.mem.Allocator,
};
```

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```zig
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
pub fn init(
    max_agents: i32,
    max_agent_radius: f32,
    nav: *NavMesh,
    allocator: std.mem.Allocator
) !Crowd

pub fn deinit(self: *Crowd) void

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏
pub fn addAgent(
    self: *Crowd,
    pos: Vec3,
    params: *const CrowdAgentParams
) i32

pub fn updateAgentParameters(
    self: *Crowd,
    idx: i32,
    params: *const CrowdAgentParams
) void

pub fn removeAgent(
    self: *Crowd,
    idx: i32
) void

// –ó–∞–ø—Ä–æ—Å—ã
pub fn getAgent(
    self: *Crowd,
    idx: i32
) ?*CrowdAgent

pub fn getActiveAgents(
    self: *Crowd,
    agents: []?*CrowdAgent,
    max_agents: i32
) i32

pub fn getEditableFilter(
    self: *Crowd,
    i: i32
) *QueryFilter

pub fn getFilter(
    self: *const Crowd,
    i: i32
) *const QueryFilter

// –¶–µ–ª–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ
pub fn requestMoveTarget(
    self: *Crowd,
    idx: i32,
    ref: PolyRef,
    pos: Vec3
) bool

pub fn requestMoveVelocity(
    self: *Crowd,
    idx: i32,
    vel: Vec3
) bool

pub fn resetMoveTarget(
    self: *Crowd,
    idx: i32
) bool

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏
pub fn update(
    self: *Crowd,
    dt: f32,
    debug: ?*CrowdAgentDebugInfo
) void

// –ò–∑–±–µ–≥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
pub fn getObstacleAvoidanceParams(
    self: *const Crowd,
    idx: i32
) *const ObstacleAvoidanceParams

pub fn setObstacleAvoidanceParams(
    self: *Crowd,
    idx: i32,
    params: *const ObstacleAvoidanceParams
) void

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
fn updateTopologyOptimization(
    self: *Crowd,
    agents: []?*CrowdAgent,
    nagents: i32,
    dt: f32
) void

fn checkPathValidity(
    self: *Crowd,
    agents: []?*CrowdAgent,
    nagents: i32,
    dt: f32
) void

fn updateMoveRequest(
    self: *Crowd,
    dt: f32
) void
```

**–¢–µ—Å—Ç—ã:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Ü–µ–ª–∏
- –ò–∑–±–µ–≥–∞–Ω–∏–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ 100+ –∞–≥–µ–Ω—Ç–∞—Ö

---

## 3.2 Path Corridor
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourPathCorridor.cpp` (442 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/detour_crowd/corridor.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub const PathCorridor = struct {
    pos: Vec3,
    target: Vec3,
    path: []PolyRef,
    npath: i32,
    max_path: i32,
    allocator: std.mem.Allocator,

    pub fn init(max_path: i32, allocator: std.mem.Allocator) !PathCorridor;
    pub fn deinit(self: *PathCorridor) void;
    pub fn reset(self: *PathCorridor, ref: PolyRef, pos: Vec3) void;
    pub fn findCorners(self: *PathCorridor, corners: []Vec3, corner_flags: []u8, corner_polys: []PolyRef, max_corners: i32, navquery: *NavMeshQuery, filter: *const Filter) i32;
    pub fn optimizePathVisibility(self: *PathCorridor, next: Vec3, path_opt_range: f32, navquery: *NavMeshQuery, filter: *const Filter) void;
    pub fn optimizePathTopology(self: *PathCorridor, navquery: *NavMeshQuery, filter: *const Filter) bool;
    pub fn moveOverOffmeshConnection(self: *PathCorridor, offMeshConRef: PolyRef, refs: []PolyRef, start_pos: *Vec3, end_pos: *Vec3, navquery: *NavMeshQuery) bool;
    pub fn movePosition(self: *PathCorridor, npos: Vec3, navquery: *NavMeshQuery, filter: *const Filter) bool;
    pub fn moveTargetPosition(self: *PathCorridor, npos: Vec3, navquery: *NavMeshQuery, filter: *const Filter) bool;
    pub fn setCorridor(self: *PathCorridor, target: Vec3, path: []const PolyRef, npath: i32) void;
    pub fn fixPathStart(self: *PathCorridor, safeRef: PolyRef, safePos: Vec3) bool;
    pub fn trimInvalidPath(self: *PathCorridor, safeRef: PolyRef, safePos: []const f32, navquery: *NavMeshQuery, filter: *const Filter) bool;
    pub fn isValid(self: *const PathCorridor, maxLookAhead: i32, navquery: *NavMeshQuery, filter: *const Filter) bool;
};
```

**–¢–µ—Å—Ç—ã:**
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏
- –î–≤–∏–∂–µ–Ω–∏–µ –≤–¥–æ–ª—å –∫–æ—Ä–∏–¥–æ—Ä–∞
- Off-mesh connections

---

## 3.3 Obstacle Avoidance
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourObstacleAvoidance.cpp` (760 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/detour_crowd/avoidance.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub const ObstacleCircle = struct {
    p: Vec3,
    vel: Vec3,
    dvel: Vec3,
    rad: f32,
    dp: Vec3,
    np: Vec3,
};

pub const ObstacleSegment = struct {
    p: Vec3, q: Vec3,
    touch: bool,
};

pub const ObstacleAvoidanceDebugData = struct {
    nsamples: i32,
    max_samples: i32,
    vel: []Vec3,
    ssize: []f32,
    pen: []f32,
    vpen: []f32,
    vcpen: []f32,
    spen: []f32,
    tpen: []f32,
};

pub const ObstacleAvoidanceQuery = struct {
    max_circles: i32,
    circles: []ObstacleCircle,
    ncircles: i32,
    max_segments: i32,
    segments: []ObstacleSegment,
    nsegments: i32,
    params: ObstacleAvoidanceParams,
    inv_h_grid: f32,
    inv_v_grid: f32,
    max_grid: i32,
    grid_size: i32,
    grid: []u16,
    allocator: std.mem.Allocator,

    pub fn init(maxCircles: i32, maxSegments: i32, allocator: std.mem.Allocator) !ObstacleAvoidanceQuery;
    pub fn deinit(self: *ObstacleAvoidanceQuery) void;
    pub fn reset(self: *ObstacleAvoidanceQuery) void;
    pub fn addCircle(self: *ObstacleAvoidanceQuery, pos: Vec3, rad: f32, vel: Vec3, dvel: Vec3) void;
    pub fn addSegment(self: *ObstacleAvoidanceQuery, p: Vec3, q: Vec3) void;
    pub fn sampleVelocityGrid(self: *ObstacleAvoidanceQuery, pos: Vec3, rad: f32, vmax: f32, vel: Vec3, dvel: Vec3, nvel: *Vec3, params: *const ObstacleAvoidanceParams, debug: ?*ObstacleAvoidanceDebugData) i32;
    pub fn sampleVelocityAdaptive(self: *ObstacleAvoidanceQuery, pos: Vec3, rad: f32, vmax: f32, vel: Vec3, dvel: Vec3, nvel: *Vec3, params: *const ObstacleAvoidanceParams, debug: ?*ObstacleAvoidanceDebugData) i32;
};

pub const ObstacleAvoidanceParams = struct {
    vel_bias: f32,
    weight_desired_vel: f32,
    weight_current_vel: f32,
    weight_side: f32,
    weight_toi: f32,
    horiz_time: f32,
    grid_size: u8,
    adaptive_divs: u8,
    adaptive_rings: u8,
    adaptive_depth: u8,
};
```

**–¢–µ—Å—Ç—ã:**
- RVO (Reciprocal Velocity Obstacle)
- Grid sampling
- Adaptive sampling

---

## 3.4 Local Boundary
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourLocalBoundary.cpp` (201 —Å—Ç—Ä–æ–∫–∞)
**–¶–µ–ª—å:** `src/detour_crowd/boundary.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub const LocalBoundary = struct {
    center: Vec3,
    segs: [DT_LOCAL_BOUNDARY_MAX_SEGS * 3]Vec3,
    nsegs: i32,
    polys: [DT_LOCAL_BOUNDARY_MAX_POLYS]PolyRef,
    npolys: i32,

    pub fn init() LocalBoundary;
    pub fn reset(self: *LocalBoundary) void;
    pub fn update(self: *LocalBoundary, ref: PolyRef, pos: Vec3, collisionQueryRange: f32, navquery: *NavMeshQuery, filter: *const Filter) void;
    pub fn isValid(self: *const LocalBoundary, navquery: *NavMeshQuery, filter: *const Filter) bool;
};
```

---

## 3.5 Proximity Grid
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourProximityGrid.cpp` (210 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/detour_crowd/grid.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub const ProximityGrid = struct {
    cell_size: f32,
    inv_cell_size: f32,
    pool: []u16,
    pool_head: i32,
    pool_size: i32,
    buckets: []u16,
    bucket_size: i32,
    bounds: [4]f32,
    allocator: std.mem.Allocator,

    pub fn init(poolSize: i32, cellSize: f32, allocator: std.mem.Allocator) !ProximityGrid;
    pub fn deinit(self: *ProximityGrid) void;
    pub fn clear(self: *ProximityGrid) void;
    pub fn addItem(self: *ProximityGrid, id: u16, minx: f32, miny: f32, maxx: f32, maxy: f32) void;
    pub fn queryItems(self: *const ProximityGrid, minx: f32, miny: f32, maxx: f32, maxy: f32, ids: []u16, maxIds: i32) i32;
};
```

---

## 3.6 Path Queue
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourCrowd/Source/DetourPathQueue.cpp` (243 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/detour_crowd/path_queue.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub const PathQueue = struct {
    const MAX_QUEUE = 8;
    const PathQuery = struct {
        ref: PathQueueRef,
        start_pos: Vec3,
        end_pos: Vec3,
        start_ref: PolyRef,
        end_ref: PolyRef,
        path: []PolyRef,
        npath: i32,
        status: Status,
        keep_alive: i32,
        filter: Filter,
    };

    queue: [MAX_QUEUE]PathQuery,
    next_handle: PathQueueRef,
    max_path_size: i32,
    queue_head: i32,
    navquery: NavMeshQuery,
    allocator: std.mem.Allocator,

    pub fn init(maxPathSize: i32, maxSearchNodeCount: i32, nav: *NavMesh, allocator: std.mem.Allocator) !PathQueue;
    pub fn deinit(self: *PathQueue) void;
    pub fn update(self: *PathQueue, max_iters: i32) void;
    pub fn request(self: *PathQueue, startRef: PolyRef, endRef: PolyRef, startPos: Vec3, endPos: Vec3, filter: *const Filter) PathQueueRef;
    pub fn getRequestStatus(self: *const PathQueue, ref: PathQueueRef) Status;
    pub fn getPathResult(self: *PathQueue, ref: PathQueueRef, path: []PolyRef, npath: *i32, maxPath: i32) Status;
};
```

---

# üî≤ –§–ê–ó–ê 4: –ú–æ–¥—É–ª—å DetourTileCache - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è

## 4.1 Tile Cache Core
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourTileCache/Source/DetourTileCache.cpp` (1,257 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/detour_tilecache/tilecache.zig`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```zig
pub const TileCacheObstacle = struct {
    const Type = enum { cylinder, box, oriented_box };

    type: Type,
    pos: Vec3,
    radius: f32,
    height: f32,
    bmin: Vec3,
    bmax: Vec3,
    rotAux: [2]f32,
    center: Vec3,
    extents: Vec3,
    next: u16,
    salt: u16,
    state: u8,
    pending: []u8,
    touched: []u8,
};

pub const TileCache = struct {
    params: TileCacheParams,
    lcp: TileCacheLayerHeaderCompressor,
    lmesh: *TileCacheMeshProcess,
    talloc: *TileCacheAlloc,
    tcomp: *TileCacheCompressor,
    tmproc: []TileCacheMeshProcess,
    ntmproc: i32,
    obstacles: []TileCacheObstacle,
    next_free_obstacle: u16,
    pos_lookup: []?*TileCacheLayer,
    tiles: []TileCacheLayer,
    salt_bits: u32,
    tile_bits: u32,
    reqs: []ObstacleRequest,
    nreqs: i32,
    update: []u8,
    nupdate: i32,
    navmesh: *NavMesh,
    allocator: std.mem.Allocator,

    pub fn init(params: *const TileCacheParams, talloc: *TileCacheAlloc, tcomp: *TileCacheCompressor, tmproc: *TileCacheMeshProcess, allocator: std.mem.Allocator) !TileCache;
    pub fn deinit(self: *TileCache) void;
    pub fn addTile(self: *TileCache, data: []u8, dataSize: i32, flags: u8, result: *TileRef) Status;
    pub fn removeTile(self: *TileCache, ref: TileRef, data: *[]u8, dataSize: *i32) Status;
    pub fn addObstacle(self: *TileCache, pos: Vec3, radius: f32, height: f32, result: *ObstacleRef) Status;
    pub fn removeObstacle(self: *TileCache, ref: ObstacleRef) Status;
    pub fn update(self: *TileCache, dt: f32, navmesh: *NavMesh, upToDate: *bool) Status;
    pub fn buildNavMeshTilesAt(self: *TileCache, tx: i32, ty: i32, navmesh: *NavMesh) Status;
    pub fn buildNavMeshTile(self: *TileCache, ref: TileRef, navmesh: *NavMesh) Status;
};
```

### –§—É–Ω–∫—Ü–∏–∏:
```zig
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º
pub fn addBoxObstacle(self: *TileCache, bmin: Vec3, bmax: Vec3, result: *ObstacleRef) Status;
pub fn addOrientedBoxObstacle(self: *TileCache, center: Vec3, extents: Vec3, yRadians: f32, result: *ObstacleRef) Status;

// –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
pub fn getObstacleByRef(self: *TileCache, ref: ObstacleRef) ?*const TileCacheObstacle;
pub fn getObstacleCount(self: *const TileCache) i32;

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–ª–∞–º–∏
pub fn getTileAt(self: *const TileCache, tx: i32, ty: i32, tlayer: i32) ?*const CompressedTile;
pub fn getTileRef(self: *const TileCache, tile: *const CompressedTile) TileRef;
pub fn getTileByRef(self: *const TileCache, ref: TileRef) ?*const CompressedTile;
```

**–¢–µ—Å—Ç—ã:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–º–µ—à–∞
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## 4.2 Tile Cache Builder
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DetourTileCache/Source/DetourTileCacheBuilder.cpp` (669 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/detour_tilecache/builder.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub fn buildTileCacheLayer(
    comp: *TileCacheCompressor,
    header: *TileCacheLayerHeader,
    heights: []const u8,
    areas: []const u8,
    cons: []const u8,
    data: *[]u8,
    data_size: *i32
) Status;

pub fn freeTileCacheLayer(alloc: *TileCacheAlloc, layer: *TileCacheLayer) void;

pub fn buildTileCacheRegions(
    alloc: *TileCacheAlloc,
    layer: *TileCacheLayer,
    walkable_climb: i32
) Status;

pub fn buildTileCacheContours(
    alloc: *TileCacheAlloc,
    layer: *TileCacheLayer,
    walkable_climb: i32,
    max_error: f32,
    lcset: *TileCacheContourSet
) Status;

pub fn buildTileCachePolyMesh(
    alloc: *TileCacheAlloc,
    lcset: *TileCacheContourSet,
    mesh: *TileCachePolyMesh
) Status;

pub fn markCylinderArea(
    layer: *TileCacheLayer,
    orig: Vec3,
    cs: f32,
    ch: f32,
    pos: Vec3,
    radius: f32,
    height: f32,
    area_id: u8
) void;

pub fn markBoxArea(
    layer: *TileCacheLayer,
    orig: Vec3,
    cs: f32,
    ch: f32,
    bmin: Vec3,
    bmax: Vec3,
    area_id: u8
) void;
```

**–¢–µ—Å—Ç—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∂–∞—Ç—ã—Ö —Å–ª–æ—ë–≤
- –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π
- –î–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è

---

# üîß –§–ê–ó–ê 5: Debug Utils

## 5.1 Recast Debug Draw
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DebugUtils/Source/RecastDebugDraw.cpp` (1,044 —Å—Ç—Ä–æ–∫–∏)
**–¶–µ–ª—å:** `src/debug/recast_debug.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub fn debugDrawHeightfieldSolid(dd: *DebugDrawer, hf: *const Heightfield) void;
pub fn debugDrawHeightfieldWalkable(dd: *DebugDrawer, hf: *const Heightfield) void;
pub fn debugDrawCompactHeightfieldSolid(dd: *DebugDrawer, chf: *const CompactHeightfield) void;
pub fn debugDrawCompactHeightfieldRegions(dd: *DebugDrawer, chf: *const CompactHeightfield) void;
pub fn debugDrawCompactHeightfieldDistance(dd: *DebugDrawer, chf: *const CompactHeightfield) void;
pub fn debugDrawHeightfieldLayer(dd: *DebugDrawer, layer: *const HeightfieldLayer, idx: i32) void;
pub fn debugDrawRegionConnections(dd: *DebugDrawer, cset: *const ContourSet, alpha: f32) void;
pub fn debugDrawRawContours(dd: *DebugDrawer, cset: *const ContourSet, alpha: f32) void;
pub fn debugDrawContours(dd: *DebugDrawer, cset: *const ContourSet, alpha: f32) void;
pub fn debugDrawPolyMesh(dd: *DebugDrawer, mesh: *const PolyMesh) void;
pub fn debugDrawPolyMeshDetail(dd: *DebugDrawer, dmesh: *const PolyMeshDetail) void;
```

---

## 5.2 Detour Debug Draw
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DebugUtils/Source/DetourDebugDraw.cpp` (346 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/debug/detour_debug.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub fn debugDrawNavMesh(dd: *DebugDrawer, mesh: *const NavMesh, flags: u8) void;
pub fn debugDrawNavMeshTile(dd: *DebugDrawer, mesh: *const NavMesh, tile: *const MeshTile) void;
pub fn debugDrawNavMeshBVTree(dd: *DebugDrawer, mesh: *const NavMesh) void;
pub fn debugDrawNavMeshNodes(dd: *DebugDrawer, query: *const NavMeshQuery) void;
pub fn debugDrawNavMeshPolysWithFlags(dd: *DebugDrawer, mesh: *const NavMesh, polyFlags: u16, col: u32) void;
pub fn debugDrawNavMeshPoly(dd: *DebugDrawer, mesh: *const NavMesh, ref: PolyRef, col: u32) void;
```

---

## 5.3 Recast Dump
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `DebugUtils/Source/RecastDump.cpp` (577 —Å—Ç—Ä–æ–∫)
**–¶–µ–ª—å:** `src/debug/dump.zig`

### –§—É–Ω–∫—Ü–∏–∏:
```zig
pub fn dumpPolyMeshToObj(mesh: *const PolyMesh, file: std.fs.File) !void;
pub fn dumpPolyMeshDetailToObj(dmesh: *const PolyMeshDetail, file: std.fs.File) !void;
pub fn dumpContourSet(cset: *const ContourSet, file: std.fs.File) !void;
```

---

# üß™ –§–ê–ó–ê 6: –¢–µ—Å—Ç—ã

## 6.1 Recast Tests
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Tests/Recast/`
**–¶–µ–ª—å:** `test/recast/`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
```zig
// test/recast/filter_test.zig
test "filterLowHangingWalkableObstacles"
test "filterLedgeSpans"
test "filterWalkableLowHeightSpans"

// test/recast/rasterize_test.zig
test "rasterizeTriangle basic"
test "rasterizeTriangle degenerate"
test "rasterizeTriangles mesh"

// test/recast/region_test.zig
test "buildDistanceField"
test "buildRegions watershed"
test "buildRegions monotone"
test "region merging"

// test/recast/contour_test.zig
test "buildContours simple"
test "simplifyContour"
test "contour edge cases"

// test/recast/mesh_test.zig
test "buildPolyMesh"
test "mergePolyMeshes"
test "polygon triangulation"

// test/recast/detail_test.zig
test "buildPolyMeshDetail"
test "height sampling"
test "delaunay triangulation"

// test/recast/alloc_test.zig
test "span allocation"
test "pool allocation"
test "memory leaks"
```

---

## 6.2 Detour Tests
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Tests/Detour/Tests_Detour.cpp`
**–¶–µ–ª—å:** `test/detour/`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
```zig
// test/detour/navmesh_test.zig
test "NavMesh initialization"
test "addTile"
test "removeTile"
test "tile linking"

// test/detour/query_test.zig
test "findNearestPoly"
test "findPath A*"
test "findPath sliced"
test "raycast"
test "moveAlongSurface"
test "findStraightPath"

// test/detour/node_test.zig
test "NodePool allocation"
test "NodeQueue priority"
test "node hashing"

// test/detour/common_test.zig
test "intersectSegmentPoly2D"
test "closestPtPointTriangle"
test "pointInPolygon"
```

---

## 6.3 DetourCrowd Tests
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Tests/DetourCrowd/Tests_DetourPathCorridor.cpp`
**–¶–µ–ª—å:** `test/crowd/`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
```zig
// test/crowd/corridor_test.zig
test "PathCorridor init"
test "optimizePathVisibility"
test "optimizePathTopology"

// test/crowd/crowd_test.zig
test "Crowd agent management"
test "agent movement"
test "collision avoidance"

// test/crowd/avoidance_test.zig
test "obstacle avoidance RVO"
test "velocity sampling"
```

---

## 6.4 Benchmarks
**–û—Ä–∏–≥–∏–Ω–∞–ª:** `Tests/Recast/Bench_rcVector.cpp`
**–¶–µ–ª—å:** `bench/`

### Benchmark —Ñ–∞–π–ª—ã:
```zig
// bench/pathfinding_bench.zig
test "benchmark A* performance"
test "benchmark large mesh"
test "benchmark crowd simulation"

// bench/rasterize_bench.zig
test "benchmark triangle rasterization"
test "benchmark large triangle count"

// bench/region_bench.zig
test "benchmark watershed"
test "benchmark distance field"
```

---

# üìö –§–ê–ó–ê 7: –ü—Ä–∏–º–µ—Ä—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## 7.1 –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### `examples/01_simple_navmesh.zig` ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –Ω–∞–≤–º–µ—à–∞ –∏–∑ –≥–µ–æ–º–µ—Ç—Ä–∏–∏

### `examples/02_tiled_navmesh.zig`
–ú–Ω–æ–≥–æ—Ç–∞–π–ª–æ–≤—ã–π –Ω–∞–≤–º–µ—à

### `examples/03_pathfinding.zig`
–ü–æ–∏—Å–∫ –ø—É—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏

### `examples/04_crowd_simulation.zig`
–°–∏–º—É–ª—è—Ü–∏—è —Ç–æ–ª–ø—ã

### `examples/05_dynamic_obstacles.zig`
–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å TileCache

### `examples/06_offmesh_connections.zig`
Off-mesh —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–ø—Ä—ã–∂–∫–∏, –¥–≤–µ—Ä–∏, —Ç–µ–ª–µ–ø–æ—Ä—Ç—ã)

---

## 7.2 –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### `examples/advanced/custom_areas.zig`
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—è–º–∏

### `examples/advanced/hierarchical_pathfinding.zig`
–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—É—Ç–∏

### `examples/advanced/streaming_world.zig`
–°—Ç—Ä–∏–º–∏–Ω–≥ –±–æ–ª—å—à–æ–≥–æ –º–∏—Ä–∞

---

## 7.3 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### `docs/API.md`
–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### `docs/MIGRATION.md`
–ú–∏–≥—Ä–∞—Ü–∏—è —Å C++ –Ω–∞ Zig –≤–µ—Ä—Å–∏—é

### `docs/PERFORMANCE.md`
–ì–∞–π–¥ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### `docs/ALGORITHMS.md`
–û–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

---

# üé® –§–ê–ó–ê 8: Zig –ò–¥–∏–æ–º—ã –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## 8.1 Comptime —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```zig
// –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –Ω–∞–≤–º–µ—à–∞
pub fn buildNavMesh(
    comptime mesh_type: enum { solo, tiled },
    allocator: std.mem.Allocator,
    config: Config
) !NavMesh {
    return switch (mesh_type) {
        .solo => buildSoloMesh(allocator, config),
        .tiled => buildTiledMesh(allocator, config),
    };
}
```

## 8.2 SIMD –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```zig
// –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
pub fn distanceFieldSIMD(
    chf: *CompactHeightfield
) void {
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Vector –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
    const Vec4f = @Vector(4, f32);
    // ...
}
```

## 8.3 –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```zig
pub const RecastError = error {
    InvalidConfig,
    OutOfMemory,
    InvalidGeometry,
    TooManyRegions,
    BuildFailed,
};

pub const DetourError = error {
    InvalidNavMesh,
    PathNotFound,
    InvalidQuery,
    NodePoolExhausted,
};
```

## 8.4 Zero-allocation path API
```zig
// –î–ª—è hot-path –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π
pub fn findPathNoAlloc(
    query: *NavMeshQuery,
    path_buffer: []PolyRef, // pre-allocated
    start: PolyRef,
    end: PolyRef,
    ...
) ![]PolyRef {
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç pre-allocated buffer
}
```

---

# üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å C++ –≤–µ—Ä—Å–∏–µ–π
- [ ] –í—Å–µ 50+ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] A* –Ω–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ C++ –≤–µ—Ä—Å–∏–∏ (¬±5%)
- [ ] Rasterization –Ω–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ (¬±10%)
- [ ] Crowd —Å–∏–º—É–ª—è—Ü–∏—è: 100+ –∞–≥–µ–Ω—Ç–æ–≤ @ 60 FPS

## –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] 90%+ test coverage
- [ ] Zero memory leaks (valgrind/asan)
- [ ] Zero UB (Zig's safety checks)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö API

## –ò–¥–∏–æ–º—ã Zig
- [ ] –Ø–≤–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä—ã –≤–µ–∑–¥–µ
- [ ] Error unions –≤–º–µ—Å—Ç–æ bool/status
- [ ] Comptime –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- [ ] SIMD –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π

---

# ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

## –ü–æ —Ñ–∞–∑–∞–º (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞):
1. **–§–ê–ó–ê 1 (Recast)**: 40-50 —á–∞—Å–æ–≤
2. **–§–ê–ó–ê 2 (Detour)**: 35-45 —á–∞—Å–æ–≤
3. **–§–ê–ó–ê 3 (Crowd)**: 25-30 —á–∞—Å–æ–≤
4. **–§–ê–ó–ê 4 (TileCache)**: 15-20 —á–∞—Å–æ–≤
5. **–§–ê–ó–ê 5 (Debug)**: 10-15 —á–∞—Å–æ–≤
6. **–§–ê–ó–ê 6 (Tests)**: 20-25 —á–∞—Å–æ–≤
7. **–§–ê–ó–ê 7 (Examples/Docs)**: 15-20 —á–∞—Å–æ–≤
8. **–§–ê–ó–ê 8 (Optimizations)**: 20-25 —á–∞—Å–æ–≤

**–ò–¢–û–ì–û: 180-230 —á–∞—Å–æ–≤ —á–∏—Å—Ç–æ–π —Ä–∞–±–æ—Ç—ã**

## –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å 20 —á/–Ω–µ–¥–µ–ª—é):
- **9-12 –Ω–µ–¥–µ–ª—å** = 2-3 –º–µ—Å—è—Ü–∞

---

# üöÄ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. **P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ)**: –§–∞–∑—ã 1-2 (Recast + Detour core)
2. **P1 (–í–∞–∂–Ω–æ)**: –§–∞–∑–∞ 3 (Crowd), –¢–µ—Å—Ç—ã
3. **P2 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)**: –§–∞–∑–∞ 4 (TileCache), Debug utils
4. **P3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**: –ü—Ä–∏–º–µ—Ä—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## Milestone plan:
- **Milestone 1** (4 –Ω–µ–¥–µ–ª–∏): Recast –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **Milestone 2** (3 –Ω–µ–¥–µ–ª–∏): Detour pathfinding
- **Milestone 3** (2 –Ω–µ–¥–µ–ª–∏): Crowd simulation
- **Milestone 4** (2 –Ω–µ–¥–µ–ª–∏): Tests + bugfixes
- **Milestone 5** (1 –Ω–µ–¥–µ–ª—è): Polish + docs

---

# üéØ –ù–∞—á–∞—Ç—å —Å...

–†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∏–Ω–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. `src/recast/rasterization.zig` - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
2. `src/recast/filter.zig` - –ø—Ä–æ—Å—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
3. `src/recast/compact.zig` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ CHF
4. `src/recast/region.zig` - —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –º–æ–¥—É–ª—å
5. `src/recast/contour.zig`
6. `src/recast/mesh.zig`
7. –ó–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ Detour

---

# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É

- [ ] –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç memory leaks
- [ ] –ù–µ—Ç undefined behavior
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] CI/CD –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Benchmark suite –≥–æ—Ç–æ–≤
- [ ] Semantic versioning
- [ ] CHANGELOG.md
- [ ] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å C API (extern)

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?** üöÄ
