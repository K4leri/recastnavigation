# –ê–Ω–∞–ª–∏–∑ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–∏—è Issue #783

## üìã –í–ê–®–ò –í–ê–†–ò–ê–ù–¢–´ –†–ï–®–ï–ù–ò–Ø

–î–∞, —É –≤–∞—Å –µ—Å—Ç—å –∏–º–µ–Ω–Ω–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∂–¥—ã–π:

## 1Ô∏è‚É£ –í–ê–†–ò–ê–ù–¢ A: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö holes

### –ö–æ–¥:
```zig
for (0..region.nholes) |i| {
    const hole = region.holes[i].contour;
    // ... –ø–æ–∏—Å–∫ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π ...

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –í–°–ï holes –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π
    for (0..region.nholes) |k| {
        if (k == i) continue;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â—É—é

        const n_hole = @intCast(region.holes[k].contour.nverts);
        intersects = intersects or intersectSegContour(
            pt, corner, -1, n_hole, region.holes[k].contour.verts);
    }
}
```

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
- ‚úÖ **–ü–æ–ª–Ω–æ—Ç–∞:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
- ‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** O(n¬≤) –¥–ª—è n holes

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –î–ª—è 10 holes: 90 –ø—Ä–æ–≤–µ—Ä–æ–∫
- –î–ª—è 20 holes: 380 –ø—Ä–æ–≤–µ—Ä–æ–∫
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: O(n¬≤)

## 2Ô∏è‚É£ –í–ê–†–ò–ê–ù–¢ B: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ holes)

### –ö–æ–¥:
```zig
for (0..region.nholes) |i| {
    const hole = region.holes[i].contour;
    // ... –ø–æ–∏—Å–∫ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π ...

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ holes –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π
    var k: usize = i + 1;
    while (k < region.nholes and !intersects) : (k += 1) {
        const n_hole = @intCast(region.holes[k].contour.nverts);
        intersects = intersects or intersectSegContour(
            pt, corner, -1, n_hole, region.holes[k].contour.verts);
    }
}
```

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** O(n¬≤/2) –≤–º–µ—Å—Ç–æ O(n¬≤)
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
- ‚ö†Ô∏è **–õ–æ–≥–∏–∫–∞:** –¢—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è, –ø–æ—á–µ–º—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏—Ö holes

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –î–ª—è 10 holes: 45 –ø—Ä–æ–≤–µ—Ä–æ–∫ (50% —ç–∫–æ–Ω–æ–º–∏—è)
- –î–ª—è 20 holes: 190 –ø—Ä–æ–≤–µ—Ä–æ–∫ (50% —ç–∫–æ–Ω–æ–º–∏—è)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: O(n¬≤/2)

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –¥–ª—è hole[i] –Ω–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ holes, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ü—Ä–µ–¥—ã–¥—É—â–∏–µ holes —É–∂–µ –±—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø—Ä–∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–µ
2. –ú—ã –∏—â–µ–º –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â—É—é—Å—è –¥–∏–∞–≥–æ–Ω–∞–ª—å - –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –ª—é–±–æ–π hole, –¥–∏–∞–≥–æ–Ω–∞–ª—å –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

## 3Ô∏è‚É£ –í–ê–†–ò–ê–ù–¢ C: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π

### –ö–æ–¥:
```zig
for (0..region.nholes) |i| {
    const hole = region.holes[i].contour;
    // ... –ø–æ–∏—Å–∫ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π ...

    // –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
    var k: usize = 0;
    while (k < region.nholes and !intersects) : (k += 1) {
        if (k == i) continue;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â—É—é

        // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ bounding box
        if (quickBoundingBoxCheck(hole, region.holes[k].contour)) {
            const n_hole = @intCast(region.holes[k].contour.nverts);
            intersects = intersects or intersectSegContour(
                pt, corner, -1, n_hole, region.holes[k].contour.verts);
        }
    }
}
```

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:
- ‚úÖ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å:** –£–º–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** Bounding box —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏: O(n¬≤) —Å k-—Ñ–∞–∫—Ç–æ—Ä–æ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏–∏ holes
- Bounding box —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: ~50-80% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫

## üìä –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞      | –í–∞—Ä–∏–∞–Ω—Ç A | –í–∞—Ä–∏–∞–Ω—Ç B | –í–∞—Ä–∏–∞–Ω—Ç C |
|-------------------|-----------|-----------|-----------|
| –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å        |     ‚úÖ     |     ‚úÖ     |     ‚úÖ     |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |  –°—Ä–µ–¥–Ω—è—è  |  –í—ã—Å–æ–∫–∞—è  |   –í—ã—Å–æ–∫–∞—è |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞     |   –ù–∏–∑–∫–∞—è  |  –°—Ä–µ–¥–Ω—è—è  |  –í—ã—Å–æ–∫–∞—è  |
| –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å         |     ‚úÖ     |     ‚úÖ     |     ‚úÖ     |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å   |  –°—Ä–µ–¥–Ω—è—è  |  –í—ã—Å–æ–∫–∞—è  |   –í—ã—Å–æ–∫–∞—è |
| –û—Ç–ª–∞–¥–∫–∞            |   –õ–µ–≥–∫–æ   |  –°—Ä–µ–¥–Ω–µ   |   –°–ª–æ–∂–Ω–æ  |

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –í–´–ë–û–†–£

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–∞–ª–µ–Ω—å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ holes (2-5)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç A
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ holes (6-20)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç B
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ë–∞–ª–∞–Ω—Å –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ holes (20+)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç C
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ holes
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç B –∏–ª–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π C
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ì–∏–±–∫–æ—Å—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

## üöÄ –û–°–ù–û–í–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ù–∞—á–Ω–∏—Ç–µ —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ B (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)**

### –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:
1. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç B** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
2. **–î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä** –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
3. **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä—å—Ç–µ** –¥–æ –í–∞—Ä–∏–∞–Ω—Ç–∞ C
4. **–û—Å—Ç–∞–≤—å—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç A** –∫–∞–∫ fallback –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```zig
const MergeStrategy = enum {
    full_check,     // –í–∞—Ä–∏–∞–Ω—Ç A
    optimal_check,  // –í–∞—Ä–∏–∞–Ω—Ç B
    hybrid_check,   // –í–∞—Ä–∏–∞–Ω—Ç C
};

fn mergeRegionHolesWithStrategy(
    ctx: *const Context,
    region: *ContourRegion,
    strategy: MergeStrategy,
    allocator: std.mem.Allocator,
) !void { /* —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è */ }
```

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

- **–í–∞—Ä–∏–∞–Ω—Ç B:** 30-50% —É—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞
- **–í–∞—Ä–∏–∞–Ω—Ç C:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ 20-40% —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:** 100% –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º

## üî¨ –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã** —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º holes
2. **–ó–∞–º–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å** –Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö
4. **–ü—Ä–æ–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã** –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–∞—Ä–∏–∞–Ω—Ç B** —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!